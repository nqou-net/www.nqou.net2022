---
date: 2014-04-29T22:11:24+09:00
draft: false
iso8601: 2014-04-29T22:11:24+09:00
tags:
  - perl
title: 開発時用のNodeモジュールをPerlでアップデートする

---

<p><a href="https://twitter.com/nqounet">@nqounet</a>です。</p>

<p>Node.jsは使っていて驚くことがいくつかあります。</p>



<p>ひとつはモジュールのバージョンアップが早いこと。</p>

<p>ひとつはモジュールが依存するモジュールを独自に持つこと。</p>

<h2>モジュールの更新が早い</h2>

<p>npmで<code>-g</code>を付けてインストールしたファイル群は<code>npm update -g</code>でアップデートできますが、その量がとても多いです。</p>

<p>ただ、ザーッと見ていると同じモジュールも何度か見かけるような気がしました。</p>

<h2>依存モジュールを独自に持っている</h2>

<p>で、ログを見たり、インストールしたディレクトリを見ると、<code>package.json</code>に書いてあるモジュール群は、全てそのディレクトリに入っています。</p>

<p>例えば、gruntの依存モジュールで<a href="https://www.npmjs.org/package/async">async.js</a>がありますが、grunt-contrib-connectもasync.jsに依存しています。</p>

<p>手元でその2つのファイルを見てみると、バージョンが異なっています。</p>

<p>gruntが依存している方は、0.1.22、grunt-contrib-connectが依存している方は、0.2.10でした。</p>

<p>依存するモジュールをバージョンを固定したまま実行できるように、ローカルにモジュールを保持する仕組みになっているようですね。</p>

<h2>勘違いしていたこと</h2>

<p>gruntを使っていてあまりにも頻繁に沢山のモジュールをダウンロード、インストールするので嫌だなと思い、衝動的にいろいろなものを<code>-g</code>オプションでインストールした（例えばgrunt-contrib-connectとか）のですが、全く（？）意味がありませんでした。</p>

<p>グローバルの方にそのモジュールがあっても、結局はローカルに適切なバージョンのモジュールをインストールするので使われません。</p>

<p>むしろ、<code>npm update -g</code>の時に（使ってもいないのに）無駄にバージョンアップするため、余計なダウンロードが発生していました。</p>

<h2>開発環境をアップデートする</h2>

<p><code>yo webapp</code>で作成した環境には<code>package.json</code>が既に作成されていますが、モジュールのバージョンは更新されているものが多いです。</p>

<p>例えば、gruntは、指定されているバージョンは0.4.1ですが、アップデートすれば0.4.4が入ります。</p>

<p>アップデートし、かつ、package.jsonも更新するには<code>npm update --save-dev</code>で良いのですが、この場合、何故そうなるのか不明ですがgruntはアップデートされないようです。</p>

<p>そういうのをいちいち気にするのがアレなので、簡単なスクリプトを書いて実行するようにしました。</p>

```perl
#!/usr/bin/env perl
use utf8;
use 5.012;

use JSON::XS qw(decode_json);
use Path::Tiny qw(path);

my $json = decode_json(path('package.json')->slurp);
my $modules = join(' ', keys $json->{devDependencies});
system(qq{npm install -D $modules});
```

<p>地味に便利です。</p>

<h2>手元で静的ファイルを更新する考え方</h2>

<p>ウェブサイトをgruntで管理していて思うのですが、設定ファイルとコマンドでウェブサイトを更新するという考え方は別に新しいわけじゃないんですよ。</p>

<p>ただ、できることが多種多様になって、かつ、それが簡単なスクリプトを書いて組み合わせられる、というのが良いですね。</p>

<p>ローカル環境で編集したものをウェブに公開する、ということが、簡単にカスタマイズできるのはほんとうに素晴らしいことだと思います。</p>
    	